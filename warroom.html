<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Orderly War Room â€” Live</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#090a12;
    --panel:#101320cc;
    --panel-2:#0f1118;
    --border:#1b1f2a;
    --text:#e6e8ef;
    --muted:#8b90a3;
    --purple:#7B3FE4;
    --green:#00D4AA;
    --red:#ff4d5a;
    --yellow:#ffc857;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    background:var(--bg);
    color:var(--text);
    min-height:100vh;
    background-image:
      radial-gradient(1200px 700px at 10% 10%, rgba(123,63,228,.15), transparent 60%),
      radial-gradient(1000px 600px at 90% 20%, rgba(0,212,170,.12), transparent 60%),
      linear-gradient(135deg, #090a12 0%, #0b0d18 30%, #0c0f1d 60%, #0a0a14 100%);
    animation:bgShift 40s ease-in-out infinite;
  }
  @keyframes bgShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
  .scanlines:before{
    content:"";position:fixed;inset:0;pointer-events:none;z-index:1;
    background:repeating-linear-gradient(0deg, rgba(255,255,255,.015), rgba(255,255,255,.015) 1px, transparent 1px, transparent 3px);
    mix-blend-mode:soft-light;opacity:.35;
  }
  .container{max-width:1450px;margin:0 auto;padding:20px 22px 48px;position:relative;z-index:2;}
  header{
    display:flex;align-items:center;justify-content:space-between;gap:16px;
    border-radius:16px;padding:16px 20px;position:relative;overflow:hidden;
    background:linear-gradient(135deg, rgba(17,19,29,.8) 0%, rgba(14,17,30,.8) 100%);
    box-shadow:0 12px 36px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.04);
    border:1px solid transparent;
  }
  header:before{
    content:"";position:absolute;inset:0;border-radius:16px;padding:1px;
    background:linear-gradient(120deg, rgba(123,63,228,.8), rgba(0,212,170,.4), rgba(123,63,228,.8));
    -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
    -webkit-mask-composite:xor;mask-composite:exclude;
    animation:headerGlow 6s linear infinite;
    pointer-events:none;
  }
  @keyframes headerGlow{0%{filter:hue-rotate(0deg)}50%{filter:hue-rotate(40deg)}100%{filter:hue-rotate(0deg)}}
  .logo{font-weight:800;letter-spacing:.18em;font-size:18px;color:#fff;text-transform:uppercase}
  .logo span{color:var(--purple);font-size:22px;letter-spacing:.2em}
  .live{
    display:flex;align-items:center;gap:8px;font-weight:700;color:var(--green);
    background:rgba(0,212,170,.12);padding:6px 12px;border-radius:999px;border:1px solid rgba(0,212,170,.35)
  }
  .dot{width:8px;height:8px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);animation:pulse 1.4s infinite}
  @keyframes pulse{0%{transform:scale(.9);opacity:.6}50%{transform:scale(1.2);opacity:1}100%{transform:scale(.9);opacity:.6}}
  .header-right{display:flex;align-items:center;gap:22px;color:var(--muted);font-size:12px;text-transform:uppercase;letter-spacing:.08em}
  .price{color:#fff;font-weight:800;font-size:18px;letter-spacing:.02em}
  .price-glow{filter:drop-shadow(0 0 10px rgba(0,212,170,.35));}
  .price-glow.red{filter:drop-shadow(0 0 10px rgba(255,77,90,.35));}
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px;margin-top:18px}
  .card{
    background:var(--panel);border-radius:16px;padding:14px 16px;position:relative;
    box-shadow:0 10px 28px rgba(0,0,0,.45);
    border:1px solid rgba(123,63,228,.18);
    backdrop-filter:blur(10px);
  }
  .card:before{
    content:"";position:absolute;inset:0;border-radius:16px;padding:1px;pointer-events:none;
    background:linear-gradient(135deg, rgba(123,63,228,.5), rgba(123,63,228,0), rgba(0,212,170,.35));
    -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
    -webkit-mask-composite:xor;mask-composite:exclude;
  }
  .card h3{margin:0 0 10px;font-size:13px;letter-spacing:.16em;color:#c9cce0;text-transform:uppercase}
  .mono{font-family:"JetBrains Mono",monospace}
  .whale{grid-column:1/-1}
  table{width:100%;border-collapse:collapse;font-size:13px}
  th,td{padding:12px 8px;border-bottom:1px solid var(--border);text-align:left}
  th{color:var(--muted);font-weight:600;font-size:11px;letter-spacing:.1em;text-transform:uppercase}
  tr{transition:all .2s ease}
  tr:hover{background:rgba(123,63,228,.12);box-shadow:inset 0 0 12px rgba(123,63,228,.25)}
  a{color:inherit;text-decoration:none}
  .addr{color:rgba(167,133,255,.9)}
  .badge{padding:4px 10px;border-radius:999px;font-weight:700;font-size:11px;letter-spacing:.04em}
  .long{background:rgba(0,212,170,.18);color:var(--green);border:1px solid rgba(0,212,170,.5);box-shadow:0 0 12px rgba(0,212,170,.2)}
  .short{background:rgba(255,77,90,.18);color:var(--red);border:1px solid rgba(255,77,90,.5);box-shadow:0 0 12px rgba(255,77,90,.2)}
  .split{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .daily{grid-column:1/7}
  .pnl{grid-column:7/13}
  .chain{grid-column:1/7}
  .builders{grid-column:7/13}
  .funding{grid-column:1/9}
  .eco{grid-column:9/13}
  .stat{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px dashed rgba(255,255,255,.06)}
  .stat:last-child{border-bottom:none}
  .value{font-size:20px;font-weight:800}
  .value.hero{font-size:38px;letter-spacing:.02em;text-shadow:0 0 18px rgba(123,63,228,.25)}
  .value.glow-green{text-shadow:0 0 16px rgba(0,212,170,.35)}
  .value.glow-red{text-shadow:0 0 16px rgba(255,77,90,.35)}
  .spark{width:110px;height:34px}
  .bars{display:flex;flex-direction:column;gap:10px;margin-top:8px}
  .bar{display:flex;align-items:center;gap:10px}
  .bar span{min-width:80px;color:var(--muted);font-size:12px}
  .bar .track{flex:1;height:12px;background:#0b0d14;border-radius:999px;overflow:hidden;border:1px solid rgba(255,255,255,.06)}
  .bar .fill{height:100%;border-radius:999px;box-shadow:0 0 12px rgba(123,63,228,.35)}
  .bar .pct{min-width:56px;text-align:right;font-size:11px;color:#c2c7dd}
  .heat{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px}
  .tile{padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.06);display:flex;flex-direction:column;gap:8px;position:relative;overflow:hidden}
  .tile:after{content:"";position:absolute;inset:-60% -60% auto auto;width:120%;height:120%;background:radial-gradient(circle, rgba(255,255,255,.12), transparent 60%);opacity:.35}
  .tile .sym{font-weight:700;font-size:12px;letter-spacing:.08em;text-transform:uppercase}
  .tile .rate{font-size:18px;font-weight:800}
  .eco-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .eco-item{padding:14px;border-radius:14px;background:rgba(15,17,24,.85);border:1px solid rgba(255,255,255,.06);box-shadow:inset 0 0 0 1px rgba(123,63,228,.08)}
  .eco-item .label{color:var(--muted);font-size:11px;letter-spacing:.1em;text-transform:uppercase}
  .eco-item .num{font-size:30px;font-weight:800;margin-top:6px;text-shadow:0 0 14px rgba(123,63,228,.3)}
  .eco-item .label.big{font-size:12px;letter-spacing:.16em;color:#d4d7e8}
  .muted{color:var(--muted)}
  .small{font-size:12px}
  .fade{opacity:.8}
  footer{margin-top:18px;color:#9aa0b6;font-size:12px;text-align:center;letter-spacing:.08em;text-transform:uppercase}
  @media(max-width:1100px){
    .grid{grid-template-columns:1fr}
    .daily,.pnl,.chain,.builders,.funding,.eco,.whale{grid-column:1/-1}
    header{flex-direction:column;align-items:flex-start}
    .header-right{flex-wrap:wrap}
  }
</style>
</head>
<body class="scanlines">
  <div class="container">
    <header>
      <div class="logo">ORDERLY <span>NETWORK</span></div>
      <div class="live"><span class="dot"></span>LIVE</div>
      <div class="header-right">
        <div>ORDER <span class="price" id="orderPrice">â€”</span> <span class="muted" id="orderChange"></span></div>
        <div class="muted">Updated <span id="updatedAgo">â€”</span> ago</div>
      </div>
    </header>

    <div class="grid">
      <section class="card whale">
        <h3>Whale Tracker</h3>
        <div class="small muted">Top open positions (real brokers only)</div>
        <div style="overflow:auto;margin-top:8px">
          <table id="whaleTable">
            <thead>
              <tr>
                <th>Wallet</th><th>Broker</th><th>Asset</th><th>Position</th><th>USD Value</th><th>Direction</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section class="card daily">
        <h3>Daily Pulse</h3>
        <div id="dailyStats"></div>
      </section>

      <section class="card pnl">
        <h3>PnL Leaderboard</h3>
        <div id="pnlList"></div>
      </section>

      <section class="card chain">
        <h3>Chain Deposits</h3>
        <div class="small muted" id="chainTotal">Total TVL: â€”</div>
        <div class="bars" id="chainBars"></div>
      </section>

      <section class="card builders">
        <h3>ðŸ’° Top Traders (7d Volume)</h3>
        <div id="builderList"></div>
      </section>

      <section class="card funding">
        <h3>Funding Rate Heat Map</h3>
        <div class="heat" id="fundingGrid"></div>
      </section>

      <section class="card eco">
        <h3>Ecosystem Counter</h3>
        <div class="eco-grid">
          <div class="eco-item"><div class="label">Total DEXs</div><div class="num mono" id="dexCount">â€”</div></div>
          <div class="eco-item"><div class="label">Trading Pairs</div><div class="num mono" id="pairCount">â€”</div></div>
          <div class="eco-item"><div class="label">Chains</div><div class="num mono" id="chainCount">â€”</div></div>
          <div class="eco-item"><div class="label big">ALLâ€‘TIME VOLUME</div><div class="num mono" id="allTimeVol">â€”</div></div>
        </div>
      </section>
    </div>
    <footer>Powered by Orderly Network | Live Data</footer>
  </div>

<script>
const fmt = (n, digits=1) => {
  if (n === null || n === undefined || isNaN(n)) return 'â€”';
  const abs = Math.abs(n);
  if (abs >= 1e12) return (n/1e12).toFixed(digits)+"T";
  if (abs >= 1e9) return (n/1e9).toFixed(digits)+"B";
  if (abs >= 1e6) return (n/1e6).toFixed(digits)+"M";
  if (abs >= 1e3) return (n/1e3).toFixed(digits)+"K";
  return n.toFixed(0);
};
const money = n => n===null? 'â€”' : '$'+fmt(n,1);
const shortAddr = a => a ? a.slice(0,6)+"â€¦"+a.slice(-4) : 'â€”';
const sleep = ms => new Promise(r=>setTimeout(r,ms));
let lastUpdateTs = Date.now();

function sparkline(values, id){
  const w=110,h=34,p=2;
  const min=Math.min(...values), max=Math.max(...values);
  const range=max-min || 1;
  const pts=values.map((v,i)=>{
    const x = p + (i/(values.length-1))*(w-2*p);
    const y = h - p - ((v-min)/range)*(h-2*p);
    return `${x},${y}`;
  }).join(' ');
  const fillPts = `0,${h} ${pts} ${w},${h}`;
  const gid = `grad-${id}`;
  return `
    <svg class="spark" viewBox="0 0 ${w} ${h}" preserveAspectRatio="none">
      <defs>
        <linearGradient id="${gid}" x1="0" x2="1" y1="0" y2="1">
          <stop offset="0%" stop-color="rgba(123,63,228,.8)" />
          <stop offset="100%" stop-color="rgba(0,212,170,.6)" />
        </linearGradient>
      </defs>
      <polyline fill="url(#${gid})" opacity=".25" points="${fillPts}" />
      <polyline fill="none" stroke="url(#${gid})" stroke-width="2" points="${pts}" />
    </svg>`;
}

async function fetchJSON(url){
  const res = await fetch(url);
  if(!res.ok) throw new Error(url+" "+res.status);
  return res.json();
}

async function loadHeader(){
  const data = await fetchJSON('https://api.coingecko.com/api/v3/simple/price?ids=orderly-network&vs_currencies=usd&include_24hr_change=true');
  const price = data['orderly-network']?.usd;
  const change = data['orderly-network']?.usd_24h_change;
  const priceEl = document.getElementById('orderPrice');
  priceEl.textContent = price? `$${price.toFixed(4)}`:'â€”';
  if(change!=null){
    const el = document.getElementById('orderChange');
    el.textContent = `(${change.toFixed(2)}%)`;
    el.style.color = change>=0? 'var(--green)' : 'var(--red)';
    priceEl.classList.toggle('price-glow', true);
    priceEl.classList.toggle('red', change<0);
  }
}

async function loadWhales(){
  const url = 'https://orderly-dashboard-query-service.orderly.network/ranking/positions?param='+encodeURIComponent(JSON.stringify({days:7,size:50}));
  const data = await fetchJSON(url);
  const rows = (data?.data?.rows||[]).filter(r=>r.broker_id!=='orderly');
  const top = rows.slice(0,10);

  const symNames = [...new Set(top.map(r=>r.symbol.replace('PERP_','').replace('_USDC','')))];
  const prices = {};
  for(const sym of symNames){
    try{
      const p = await fetchJSON(`https://api-evm.orderly.org/v1/public/futures/PERP_${sym}_USDC`);
      prices[sym] = p?.data?.mark_price || p?.data?.index_price || null;
      await sleep(300);
    }catch(e){prices[sym]=null}
  }

  const tbody = document.querySelector('#whaleTable tbody');
  tbody.innerHTML='';
  top.forEach(r=>{
    const sym = r.symbol.replace('PERP_','').replace('_USDC','');
    const price = prices[sym] || 0;
    const holding = parseFloat(r.holding||0);
    const usd = Math.abs(holding) * price;
    const dir = holding >=0 ? 'LONG' : 'SHORT';
    const addr = r.address || '';
    const b64 = btoa(addr).replace(/=+$/,'');
    const href = `https://dashboard.orderly.network/address/${b64}?broker_id=${r.broker_id}&tab=positions`;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="mono addr"><a href="${href}" target="_blank">${shortAddr(addr)}</a></td>
      <td>${r.broker_id}</td>
      <td>${sym}</td>
      <td class="mono">${fmt(Math.abs(holding),2)}</td>
      <td class="mono value ${usd>=0?'glow-green':''}">${money(usd)}</td>
      <td><span class="badge ${dir==='LONG'?'long':'short'}">${dir}</span></td>
    `;
    tbody.appendChild(tr);
  });
}

async function loadDaily(){
  const url = 'https://orderly-dashboard-query-service.orderly.network/daily_orderly_perp?param='+encodeURIComponent(JSON.stringify({days:7}));
  const data = await fetchJSON(url);
  const rows = data?.data?.data || [];
  if(!rows.length) return;
  const last = rows[rows.length-1];
  const stats = [
    {label:'Volume', val:last.trading_volume, series: rows.map(r=>r.trading_volume)},
    {label:'Trades', val:last.trading_count, series: rows.map(r=>r.trading_count)},
    {label:'Active Users', val:last.trading_user_count, series: rows.map(r=>r.trading_user_count)},
    {label:'Liquidations', val:last.liquidation_count, series: rows.map(r=>r.liquidation_count)},
    {label:'Fees', val:last.trading_fee, series: rows.map(r=>r.trading_fee)},
  ];
  const wrap = document.getElementById('dailyStats');
  wrap.innerHTML='';
  stats.forEach((s,i)=>{
    const div = document.createElement('div');
    div.className='stat';
    div.innerHTML = `<div><div class="muted small">${s.label}</div><div class="value mono ${i===0?'hero glow-green':'glow-green'}">${money(s.val)}</div></div><div>${sparkline(s.series, s.label)}</div>`;
    wrap.appendChild(div);
  })
}

async function loadPnL(){
  const url = 'https://orderly-dashboard-query-service.orderly.network/ranking/realized_pnl?param='+encodeURIComponent(JSON.stringify({days:7,size:20}));
  const data = await fetchJSON(url);
  const rows = (data?.data?.rows||[]).filter(r=>r.broker_id!=='orderly');
  const map = new Map();
  rows.forEach(r=>{
    const key = r.address || r.wallet;
    if(!map.has(key)) map.set(key,{address:key, pnl:0, symbols:new Set(), broker:r.broker_id});
    const obj = map.get(key);
    obj.pnl += Number(r.total_realized_pnl||0);
    if(r.symbol) obj.symbols.add(r.symbol.replace('PERP_','').replace('_USDC',''));
  });
  const arr = Array.from(map.values()).sort((a,b)=>b.pnl-a.pnl).slice(0,5);
  const wrap = document.getElementById('pnlList');
  wrap.innerHTML='';
  arr.forEach((r,i)=>{
    const row = document.createElement('div');
    row.className='stat';
    const crown = i===0 ? 'ðŸ† ' : '';
    const glow = r.pnl>=0 ? 'glow-green' : 'glow-red';
    row.innerHTML = `
      <div><div class="muted small">${crown}#${i+1} ${shortAddr(r.address)}</div><div class="value mono ${glow}">${money(r.pnl)}</div></div>
      <div class="small muted" style="text-align:right">${[...r.symbols].slice(0,4).join(', ')}<br><span class="fade">${r.broker}</span></div>
    `;
    wrap.appendChild(row);
  })
}

async function loadChains(){
  const data = await fetchJSON('https://api.llama.fi/protocols');
  const protocol = data.find(p=>p.slug==='orderly-bridge');
  const chainTvls = protocol?.chainTvls || {};
  const entries = Object.entries(chainTvls).map(([k,v])=>({chain:k, tvl:v})).sort((a,b)=>b.tvl-a.tvl).slice(0,10);
  const total = Object.values(chainTvls).reduce((a,b)=>a+b,0);
  document.getElementById('chainTotal').textContent = `Total TVL: ${money(total)}`;
  const colors={Solana:'#9945FF',Arbitrum:'#28A0F0',Ethereum:'#627EEA',Optimism:'#FF0420',Base:'#0052FF',Avalanche:'#E84142',BNB:'#F0B90B'};
  const max = entries[0]?.tvl || 1;
  const wrap = document.getElementById('chainBars');
  wrap.innerHTML='';
  entries.forEach(e=>{
    const row=document.createElement('div');
    row.className='bar';
    const pct = total ? (e.tvl/total*100) : 0;
    const color = colors[e.chain]||'var(--purple)';
    row.innerHTML=`<span>${e.chain}</span><div class="track"><div class="fill" style="width:${(e.tvl/max)*100}%;background:linear-gradient(90deg, ${color} 0%, rgba(0,0,0,0) 100%)"></div></div><div class="pct mono">${pct.toFixed(1)}%</div><div class="mono small">${money(e.tvl)}</div>`;
    wrap.appendChild(row);
  })
}

const BROKER_NAMES={orderly:'Orderly',woofi_pro:'WOOFi Pro',logx:'LogX',sharpe_ai:'Sharpe AI',vooi:'vooi.io',citrex:'Citrex',rage_trade:'Rage Trade',book_x:'BookX',filament:'Filament',btse_dex:'BTSE DEX',saros:'Saros',jojo:'JOJO',kodiak_fi:'KodiakFi',ascendex:'AscendEX',raydium:'Raydium',quick_perps:'QuickSwap',aden:'Aden',zetarium:'Zetarium'};
async function loadBuilders(){
  const [volData,pnlData,posData] = await Promise.all([
    fetchJSON('https://orderly-dashboard-query-service.orderly.network/ranking/trading_volume?param='+encodeURIComponent(JSON.stringify({days:7,size:10}))),
    fetchJSON('https://orderly-dashboard-query-service.orderly.network/ranking/realized_pnl?param='+encodeURIComponent(JSON.stringify({days:7,size:50}))),
    fetchJSON('https://orderly-dashboard-query-service.orderly.network/ranking/positions?param='+encodeURIComponent(JSON.stringify({days:7,size:50}))),
  ]);
  const brokerMap={};
  for(const r of (pnlData?.data?.rows||[])){if(r.account_id&&r.broker_id)brokerMap[r.account_id]=r.broker_id;}
  for(const r of (posData?.data?.rows||[])){if(r.account_id&&r.broker_id)brokerMap[r.account_id]=r.broker_id;}
  const accounts=volData?.data?.account_ids||[];
  const volumes=volData?.data?.volume||[];
  const wrap=document.getElementById('builderList');
  wrap.innerHTML='';
  accounts.slice(0,7).forEach((a,i)=>{
    const vol=volumes[i]||0;
    const broker=brokerMap[a]||'';
    const brokerName=BROKER_NAMES[broker]||broker||'';
    const addr=a.slice(0,10)+'\u2026'+a.slice(-6);
    const b64=btoa(a).replace(/=+$/,'');
    const href=broker?`https://dashboard.orderly.network/address/${b64}?broker_id=${broker}&tab=positions`:`https://dashboard.orderly.network/address/${b64}?tab=positions`;
    const row=document.createElement('div');
    row.className='stat';
    row.innerHTML=`<div><div class="muted small"><a href="${href}" target="_blank" style="color:var(--muted)">#${i+1} ${addr}</a></div><div class="value mono glow-green">${money(vol)}</div></div><div class="small muted">${brokerName||'7d volume'}</div>`;
    wrap.appendChild(row);
  });
}

const fundingSyms = ['BTC','ETH','SOL','XAU','XAG','TSLA','NVDA','AAPL','GOOGL','DOGE','PEPE','PUMP','ORDER','BNB','AVAX','ARB'];
async function loadFunding(){
  const grid = document.getElementById('fundingGrid');
  grid.innerHTML='';
  for(const sym of fundingSyms){
    let rate=0;
    try{
      const data = await fetchJSON(`https://api-evm.orderly.org/v1/public/funding_rate/PERP_${sym}_USDC`);
      rate = data?.data?.est_funding_rate || data?.data?.rate || 0;
    }catch(e){rate=0}
    const annual = rate * 24 * 365 * 100;
    const intensity = Math.min(Math.abs(annual)/50,1);
    const color = annual>=0? `rgba(0,212,170,${0.25+0.6*intensity})` : `rgba(255,77,90,${0.25+0.6*intensity})`;
    const glow = annual>=0? '0 0 16px rgba(0,212,170,.25)' : '0 0 16px rgba(255,77,90,.25)';
    const tile = document.createElement('div');
    tile.className='tile';
    tile.style.background = color;
    tile.style.boxShadow = glow;
    tile.innerHTML = `<div class="sym">${sym}</div><div class="rate mono">${annual.toFixed(2)}%</div><div class="small muted">annualized</div>`;
    grid.appendChild(tile);
    await sleep(500);
  }
}

async function loadEco(){
  const [dex, info, chains, vol] = await Promise.all([
    fetchJSON('https://api-evm.orderly.org/v1/public/broker/name'),
    fetchJSON('https://api-evm.orderly.org/v1/public/info'),
    fetchJSON('https://api-evm.orderly.org/v1/public/chain_info'),
    fetchJSON('https://api-evm.orderly.org/v1/public/volume/stats')
  ]);
  animateNum('dexCount', dex?.data?.rows?.length||0);
  animateNum('pairCount', info?.data?.rows?.length||0);
  animateNum('chainCount', chains?.data?.rows?.length||0);
  animateNum('allTimeVol', vol?.data?.perp_volume_ltd||0, true);
}

function animateNum(id, value, moneyFmt=false){
  const el = document.getElementById(id);
  const start = 0; const end = value; const duration=1200; const startTime = performance.now();
  const tick = (t)=>{
    const p = Math.min((t-startTime)/duration,1);
    const v = start + (end-start)*p;
    el.textContent = moneyFmt ? money(v) : Math.round(v).toLocaleString();
    if(p<1) requestAnimationFrame(tick);
  };
  requestAnimationFrame(tick);
}

function updateAgo(){
  const diff = Math.max(0, Math.floor((Date.now()-lastUpdateTs)/1000));
  const el = document.getElementById('updatedAgo');
  el.textContent = diff < 60 ? `${diff}s` : `${Math.floor(diff/60)}m ${diff%60}s`;
}

async function refreshAll(){
  lastUpdateTs = Date.now();
  updateAgo();
  const safe = fn => fn().catch(e=>console.warn(fn.name, e.message));
  await safe(loadHeader);
  await safe(loadEco);
  await sleep(500);
  await safe(loadDaily);
  await safe(loadPnL);
  await sleep(500);
  await safe(loadChains);
  await safe(loadWhales);
  safe(loadFunding);
  safe(loadBuilders);
}

refreshAll();
setInterval(refreshAll, 60000);
setInterval(updateAgo, 1000);
</script>
</body>
</html>
